const page = props.page;

const [showMenu, setShowMenu] = useState(false);

const { href: linkHref } = VM.require(`${REPL_DEVHUB}/widget/core.lib.url`);

const { href } = VM.require(`${REPL_DEVHUB}/widget/core.lib.url`);
href || (href = () => {});
linkHref || (linkHref = () => {});

const Logo = () => {
  const Wrapper = styled.div`
    .text-lg {
      font-size: 22px;
    }

    a:hover {
      text-decoration: none;
    }
  `;

  return (
    <Wrapper>
      <Link
        to={href({
          widgetSrc: `${REPL_AI_PGF_FORUM}/widget/app`,
          params: { page: "" },
        })}
      >
        <svg
          width="117.45"
          height="37.8"
          viewBox="0 0 2349 756"
          fill="none"
          xmlns="http://www.w3.org/2000/svg"
        >
          <path
            d="M365.058 124.254C365.058 119.558 365.344 115.473 364.905 111.445C364.733 109.899 363.206 108.085 361.793 107.15C344.804 95.8302 338.161 71.8733 347.209 53.8531C357.269 33.7712 381.551 25.6392 400.602 35.9665C421.046 47.0573 428.873 72.9804 416.885 92.1651C413.506 97.5482 407.817 101.461 403.312 106.177C402.243 107.303 401.06 108.849 400.964 110.262C400.659 114.862 400.85 119.482 400.85 124.025C406.691 124.025 412.551 123.949 418.393 124.025C441.433 124.369 464.589 122.441 487.381 127.518C511.491 132.882 533.653 142.847 553.391 157.45C574.886 173.332 591.303 193.853 602.737 218.077C607.433 228.023 611.117 238.465 615.527 249.384C622.113 251.102 630.206 253.087 638.224 255.378C674.932 265.858 699.023 297.832 699.786 335.991C700.645 378.465 677.242 407.996 640.362 421.034C631.466 424.183 622.151 426.092 613.102 428.803C611.728 429.223 610.067 430.674 609.647 432.01C602.145 456.444 588.115 476.774 569.789 494.069C554.689 508.329 537.242 519.515 517.58 526.215C509.544 528.964 506.833 533.278 504.256 540.761C495.99 564.661 484.899 587.11 463.329 602.266C439.314 619.141 412.532 629.488 383.192 629.354C327.795 629.125 283.127 596.081 265.355 547.423C261.231 536.161 255.944 529.766 244.185 525.012C203.391 508.519 174.49 478.893 157.1 438.348C155.42 434.415 153.53 432.124 148.949 431.227C127.225 426.951 108.613 416.567 91.4522 402.613C63.0475 379.515 53.9228 333.319 73.0502 298.92C83.6256 279.907 97.7516 265.17 118.96 258.527C128.485 255.549 138.24 253.335 147.842 250.548C149.178 250.166 150.858 248.582 151.106 247.284C155.783 224.014 167.37 204.085 182.049 186.065C212.649 148.478 253.596 129.866 300.918 124.788C316.857 123.07 333.121 124.349 349.252 124.254C354.081 124.235 358.911 124.254 365.077 124.254H365.058ZM380.596 163.921C380.596 163.921 380.596 163.788 380.596 163.711C360.896 163.711 341.177 163.463 321.477 163.807C308.63 164.036 295.42 163.425 282.993 166.098C224.332 178.715 188.101 224.854 181.878 284.26C179.129 310.507 180.637 337.232 180.809 363.728C180.923 380.03 183.252 396.065 187.872 411.852C202.666 462.362 254.779 502.201 307.523 502.411C352.478 502.583 397.452 502.525 442.407 502.315C459.015 502.239 475.603 502.125 491.695 496.321C512.197 488.934 531.057 479.103 546.08 463.049C570.553 436.935 580.937 405.056 582.121 370.065C582.98 344.658 582.159 319.193 582.159 293.766C582.159 265.877 574.275 240.526 557.935 217.848C532.661 182.839 498.815 164.112 455.273 163.94C430.381 163.845 405.469 163.94 380.577 163.94L380.596 163.921ZM306.721 542.231C314.242 569.395 347.056 591.519 385.769 592.378C423.909 593.218 453.765 566.875 461.801 542.231H306.721ZM142.688 288.192C116.86 296.992 98.267 315.967 102.028 344.963C105.005 367.889 124.992 390.796 142.688 390.491V288.192ZM621.273 390.166C654.297 377.644 664.09 360.521 661.112 330.398C659.203 311.08 639.713 294.587 621.273 289.223V390.166ZM395.562 72.7132C395.829 64.9248 390.427 59.1598 382.562 58.8544C376.053 58.6063 369.181 64.4094 368.818 70.4797C368.417 77.0464 375.442 84.5485 382.123 84.7203C389.95 84.9303 395.295 80.158 395.562 72.7323V72.7132Z"
            fill="black"
          />
          <rect
            width="41.4893"
            height="23.0496"
            rx="11.5248"
            transform="matrix(-1 0 0 1 254.97 680.682)"
            fill="black"
          />
          <rect
            x="273.409"
            y="680.682"
            width="207.446"
            height="23.0496"
            rx="11.5248"
            fill="black"
          />
          <rect
            width="41.4893"
            height="23.0496"
            rx="11.5248"
            transform="matrix(-1 0 0 1 540.785 680.682)"
            fill="black"
          />
          <path
            d="M305.213 355.728C304.984 369.606 301.701 375.294 293.149 375.619C290.381 375.733 287.04 374.531 284.845 372.794C282.516 370.942 280.664 367.964 279.653 365.101C278.679 362.352 279.08 359.126 278.927 356.816C272.265 354.449 266.08 352.368 259.991 350.001C257.872 349.18 255.829 347.844 254.092 346.355C239.012 333.47 244.051 324.288 256.574 313.598C257.662 312.682 260.449 312.815 261.957 313.522C265.679 315.24 269.268 317.34 272.609 319.688C280.187 324.994 288.605 326.407 297.596 325.892C301.624 325.663 304.545 324.135 305.213 319.84C305.862 315.583 304.22 312.014 300.154 310.849C294.179 309.131 287.956 308.349 281.848 307.031C271.941 304.893 261.766 303.595 254.684 294.795C237.389 273.301 243.459 243.598 268.046 231.076C271.005 229.568 274.403 228.899 278.374 227.601C277.648 218.267 277.61 207.558 291.373 207.615C300.479 207.653 304.526 215.289 304.01 228.25C313.498 229.911 322.756 232.851 329.418 240.296C332.472 243.713 335.049 248.199 336.099 252.608C337.321 257.724 334.82 262.458 329.972 265.264C324.646 268.357 319.053 269.941 313.23 266.581C310.768 265.15 308.515 263.336 306.187 261.656C299.143 256.579 291.24 256.445 283.68 259.289C280.836 260.358 277.992 264.291 277.228 267.421C276.216 271.64 279.748 274.026 283.852 275.019C292.175 277.023 300.479 279.199 308.821 281.147C339.593 288.305 345.396 319.191 330.716 340.38C324.512 349.314 316.609 355.499 305.251 355.69L305.213 355.728Z"
            fill="black"
          />
          <path
            d="M488.544 227.71C494.615 229.848 500.494 231.166 505.553 233.953C509.943 236.377 513.99 240.004 517.178 243.936C522.886 250.942 522.39 256.325 516.663 263.216C512.1 268.714 503.701 270.699 497.268 267.55C494.901 266.385 492.534 264.877 490.682 263.025C484.574 256.917 477.377 256.554 469.78 258.826C465.676 260.048 462.22 262.586 462.259 267.473C462.297 272.15 464.988 275.128 469.512 276.235C476.614 277.991 483.734 279.614 490.854 281.313C505.19 284.711 517.178 291.125 521.072 306.721C525.463 324.378 519.679 338.943 505.782 349.977C501.411 353.451 495.321 354.768 489.117 357.46C489.193 358.09 489.403 359.941 489.633 361.812C490.549 369.696 486.044 375.518 478.675 375.938C470.066 376.434 464.225 371.433 464.11 363.435C463.996 355.894 463.996 355.837 455.31 354.482C447.484 353.241 440.516 350.187 434.98 344.517C425.646 334.954 427.631 322.908 439.275 316.284C444.067 313.555 448.152 314.662 452.084 317.85C460.216 324.416 469.283 327.795 479.935 326.612C485.49 326.001 489.442 323.424 489.804 319.281C490.186 315.12 487.055 311.378 481.577 310.29C474.571 308.916 467.47 308.133 460.464 306.797C438.512 302.578 427.02 285.341 430.284 261.307C432.632 244.051 444.181 235.022 459.682 230.154C462.965 229.123 464.645 228.589 463.538 224.542C462.106 219.273 462.85 214.272 467.966 210.759C472.605 207.571 477.072 207.667 482.054 210.053C487.628 212.706 489.232 217.116 488.907 222.747C488.812 224.504 488.64 226.26 488.525 227.71H488.544Z"
            fill="black"
          />
          <path
            d="M384.069 448.802C357.115 448.802 335.067 438.151 317.753 417.802C314.833 414.366 312.428 410.071 311.072 405.756C308.591 397.911 312.408 390.256 319.681 386.381C326.974 382.506 332.395 383.727 338.656 390.695C339.611 391.764 340.546 392.852 341.386 393.997C356.657 415.129 384.718 420.551 407.644 408.944C415.299 405.069 422.209 398.273 427.325 391.249C433.434 382.849 442.196 383.422 448.476 386.858C455.291 390.561 458.173 399.151 454.642 406.921C447.827 421.887 435.973 432.061 421.656 439.43C409.897 445.5 397.317 448.745 384.088 448.802H384.069Z"
            fill="black"
          />
          <path
            d="M525.311 421.07C511.605 420.86 501.679 411.907 501.736 399.824C501.794 388.027 512.274 378.787 525.159 379.169C536.001 379.475 546.119 390.241 545.89 401.217C545.661 412.022 536.097 421.242 525.311 421.07Z"
            fill="black"
          />
          <path
            d="M242.045 422.578C230.553 422.921 220.551 413.816 220.226 402.706C219.902 391.768 230.439 381.173 241.873 380.944C252.544 380.734 263.73 391.233 264.055 401.732C264.418 413.243 254.988 422.177 242.045 422.558V422.578Z"
            fill="black"
          />
          <path
            d="M1095.94 283.17L1070.3 395.868H1121.77L1095.94 283.17ZM1062.74 233.369H1129.33L1203.66 508.75H1149.25L1132.28 440.689H1059.42L1042.82 508.75H988.409L1062.74 233.369ZM1241.66 281.325V233.369H1405.63V281.325H1350.85V460.793H1405.63V508.75H1241.66V460.793H1296.44V281.325H1241.66ZM1456.35 375.209H1651.87V424.826H1456.35V375.209ZM1749.44 279.112V359.9H1771.76C1789.59 359.9 1802.07 356.888 1809.2 350.862C1816.46 344.837 1820.09 334.385 1820.09 319.506C1820.09 304.627 1816.46 294.175 1809.2 288.15C1802.07 282.125 1789.59 279.112 1771.76 279.112H1749.44ZM1695.03 233.369H1769.73C1807.73 233.369 1835.03 240.132 1851.63 253.658C1868.35 267.184 1876.71 289.134 1876.71 319.506C1876.71 349.879 1868.35 371.828 1851.63 385.354C1835.03 398.88 1807.73 405.643 1769.73 405.643H1749.44V508.75H1695.03V233.369ZM2053.6 458.949V406.381H2016.34V360.638H2101.19V486.801C2090.73 495.777 2079.17 502.602 2066.51 507.274C2053.97 511.824 2040.5 514.099 2026.12 514.099C1990.46 514.099 1962.91 501.741 1943.48 477.025C1924.05 452.186 1914.34 416.956 1914.34 371.336C1914.34 324.978 1924.12 289.564 1943.67 265.094C1963.34 240.624 1991.68 228.389 2028.7 228.389C2039.76 228.389 2050.65 229.987 2061.34 233.184C2072.04 236.258 2082.06 240.747 2091.41 246.649V306.964C2083.79 297.126 2074.99 289.748 2065.03 284.83C2055.2 279.788 2044.38 277.267 2032.57 277.267C2011.91 277.267 1996.48 285.076 1986.27 300.692C1976.07 316.186 1970.97 339.734 1970.97 371.336C1970.97 401.954 1975.88 425.256 1985.72 441.242C1995.56 457.227 2009.88 465.22 2028.7 465.22C2034.35 465.22 2039.27 464.728 2043.45 463.745C2047.63 462.638 2051.02 461.039 2053.6 458.949ZM2325.47 281.325H2208.35V340.718H2314.96V388.674H2208.35V508.75H2153.94V233.369H2325.47V281.325Z"
            fill="#041527"
          />
        </svg>
      </Link>
    </Wrapper>
  );
};

const ProfileIcon = () => {
  const Wrapper = styled.svg`
    padding: 0.25rem;
    @media screen and (max-width: 768px) {
      display: none;
    }
  `;
  return (
    <Widget
      src={`${REPL_AI_PGF_FORUM}/widget/components.molecule.Profile`}
      props={{
        accountId: context.accountId,
      }}
    />
  );
};

const MenuIcon = () => (
  <svg
    xmlns="http://www.w3.org/2000/svg"
    width="16"
    height="16"
    viewBox="0 0 16 16"
    fill="none"
    style={{ height: 20, width: 20 }}
  >
    <path
      fill-rule="evenodd"
      clip-rule="evenodd"
      d="M2 12.2986H14V13.3732H2V12.2986ZM2 9.07471H14V10.1493H2V9.07471ZM2 5.85083H14V6.92546H2V5.85083ZM2 2.62695H14V3.70158H2V2.62695Z"
      fill="#818181"
    />
  </svg>
);

const Navbar = styled.div`
  display: flex;
  flex-direction: row;
  justify-content: space-between;
  align-items: center;
  border: 1px solid #f1f1f1;
  border-width: 0px;
  border-bottom-width: 1px;
  padding-bottom: 15px;

  background: #ffffff;

  @media screen and (max-width: 768px) {
    padding: 1.875rem 1.375rem;
  }
`;

const LinksContainer = styled.div`
  display: flex;
  flex-direction: row;
  align-items: center;
  gap: 1.5rem;

  @media screen and (max-width: 768px) {
    display: none;
  }
`;

const MobileMenu = styled.button`
  all: unset;
  display: none;

  @media screen and (max-width: 768px) {
    display: block;
  }
`;

let links = [
  {
    title: "Proposals",
    href: "proposals",
    links: [],
  },
  {
    title: "RFPs",
    href: "rfps",
    links: [],
  },
  {
    title: "About",
    href: "https://aipgf.com/about",
    links: [],
  },
  {
    title: "Ideas",
    href: "https://aipgf.com/ideas",
    links: [],
  },
];

const isModerator = Near.view(
  "${REPL_AI_PGF_FORUM_CONTRACT}",
  "is_allowed_to_write_rfps",
  {
    editor: context.accountId,
  }
);

if (isModerator) {
  links = [
    {
      title: "Admin",
      href: "admin",
      links: [],
    },
    ...links,
  ];
}

const MobileNav = styled.div`
  display: none;

  @media screen and (max-width: 768px) {
    display: flex;
  }

  position: absolute;
  top: 0;
  right: 0;

  width: 207px;

  padding: 24px 36px 36px 16px;
  flex-direction: column;
  align-items: flex-end;
  gap: 2.5rem;
  flex-shrink: 0;

  border-radius: 0px 0px 0px 16px;
  background: rgba(41, 41, 41, 0.6);
  backdrop-filter: blur(5px);

  z-index: 50;
`;

const MobileLink = styled.a`
  color: #f4f4f4 !important;
  font-size: 20px;
  font-style: normal;
  font-weight: 400;
  line-height: 20px; /* 100% */
  margin-bottom: 1rem;

  &.active {
    color: #00ec97 !important;
  }

  &:hover {
    text-decoration: none;
    color: #00ec97 !important;
  }
`;

return (
  <Navbar className="position-relative">
    <Logo />
    <div className="d-flex gap-3 align-items-center">
      <LinksContainer>
        {links.map((link) => (
          <Widget
            src={`${REPL_AI_PGF_FORUM}/widget/components.molecule.NavbarDropdown`}
            props={{
              title: link.title,
              href: link.href,
              links: link.links,
              page: page,
            }}
          />
        ))}
      </LinksContainer>
      <Link
        to={href({
          widgetSrc: `${REPL_AI_PGF_FORUM}/widget/app`,
          params: { page: "create-proposal" },
        })}
      >
        <button
          style={{
            color: "white",
            backgroundColor: "#0057FF",
            borderWidth: 0,
            borderRadius: 100,
          }}
          className="d-flex px-4 py-2 gap-2 align-items-center"
        >
          <div>
            +
          </div>
          Submit Proposal
        </button>
      </Link>
      {context.accountId ? (
        <ProfileIcon />
      ) : (
        <button
          id="open-walletselector-button"
          type="button"
          class="login-button"
        >
          Login
        </button>
      )}
      <MobileMenu onClick={() => setShowMenu(!showMenu)}>
        <MenuIcon />
      </MobileMenu>
    </div>
    {showMenu && (
      <MobileNav>
        <div
          onClick={() => setShowMenu(!showMenu)}
          style={{ cursor: "pointer" }}
        >
          <i className="bi bi-x" style={{ fontSize: 20, color: "#F4F4F4" }}></i>
        </div>
        <div className="d-flex flex-column gap-2">
          {links.map((link, idx) =>
            link.href ? (
              <MobileLink
                key={`mobile-link-${idx}`}
                className={link.href === props.page && "active"}
                href={`/${REPL_AI_PGF_FORUM}/widget/app?page=${link.href}`}
              >
                {link.title}
              </MobileLink>
            ) : (
              link.links.map((it, idx) =>
                it.href.startsWith("http://") ||
                it.href.startsWith("https://") ? (
                  <MobileLink
                    key={`nested-link-${idx}`}
                    className={link.href === props.page && "active"}
                    href={it.href}
                    target="no_blank"
                  >
                    /{it.title}
                  </MobileLink>
                ) : (
                  <MobileLink
                    key={`nested-link-${idx}`}
                    className={link.href === props.page && "active"}
                    href={`/${REPL_AI_PGF_FORUM}/widget/app?page=${it.href}`}
                  >
                    /{it.title}
                  </MobileLink>
                )
              )
            )
          )}
        </div>
      </MobileNav>
    )}
  </Navbar>
);
